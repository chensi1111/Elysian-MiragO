import{d as ee,V as te,b as r,W as se,e as ae,G as oe,r as re,o as ne,j as ce,k as e,C as d,I as _,m as q,l as p,v as m,U as ie,y as le,D as de,E as ue,a0 as ve,$ as A,Z as k,Y as _e,T as x,_ as pe}from"./index-Cnln09QU.js";const me="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let he=(n=21)=>{let h="",f=crypto.getRandomValues(new Uint8Array(n));for(;n--;)h+=me[f[n]&63];return h};const o=n=>(de("data-v-837e01d7"),n=n(),ue(),n),fe={class:"container"},ge=o(()=>e("div",{class:"title"},"結帳",-1)),ye={class:"details"},Se=o(()=>e("div",{class:"sub-title"},"詳細資訊",-1)),Ce=o(()=>e("div",{class:"detail"},"信箱",-1)),De={class:"info"},Ve=o(()=>e("div",{class:"detail"},"聯絡資訊",-1)),ze={class:"info"},Ne={class:"info"},be=o(()=>e("div",{class:"detail"},"配送地址",-1)),we={class:"info"},Ie={class:"info"},qe=o(()=>e("div",{class:"detail"},"配送方式",-1)),Ae={class:"info"},Be=o(()=>e("div",{class:"sub-title"},"付款方式",-1)),$e={class:"details active"},ke=o(()=>e("div",{class:"detail"},"信用卡",-1)),xe={class:"credict"},Me=o(()=>e("div",{class:"topic"},"信用卡付款",-1)),Pe={class:"info-container"},Ue={class:"top"},Ee=o(()=>e("div",{class:"card-title"},"信用卡號",-1)),Re={class:"error"},Fe={class:"error"},Ye={class:"bottom"},Te={class:"card"},je=o(()=>e("div",{class:"card-title"},"有效期限",-1)),Ge={class:"error"},He={class:"error"},Oe={class:"card"},We=o(()=>e("div",{class:"card-title"},"安全碼",-1)),Ze={class:"error"},Je={class:"error"},Ke=ee({__name:"ConfirmPayment",setup(n){const h=te(),f=r();se(h,t=>{t&&(f.value=t)});function M(){const t=new Date,s=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),I=String(t.getHours()).padStart(2,"0"),C=String(t.getMinutes()).padStart(2,"0"),D=String(t.getSeconds()).padStart(2,"0");return`${s}-${l}-${a}T${I}:${C}:${D}`}const V=ae(),B=V.cartItems.map(t=>({name:t.name,price:t.price,img:t.img,quantity:t.quantity,color:t.color,size:t.size,category:t.category,id:P(t.id)}));function P(t){return(t%1e3).toString().padStart(3,"0")}function z(t){switch(t.size){case"32A":return"size32A";case"32B":return"size32B";case"32C":return"size32C";case"32D":return"size32D";case"34A":return"size34A";case"34B":return"size34B";case"34C":return"size34C";case"34D":return"size34D";case"36A":return"size36A";case"36B":return"size36B";case"36C":return"size36C";case"36D":return"size36D";case"24":return"size24";case"25":return"size25";case"26":return"size26";default:return t.size}}const c=ie(),U=c.query.email,E=c.query.firstName,R=c.query.lastName,F=oe(()=>E+R),Y=c.query.phone,T=c.query.country,j=c.query.district,G=c.query.address,H=c.query.shipping,u=r(),i=r(),v=r(),N=r(!0),b=r(!0),w=r(!0),g=r(!0),y=r(!0),S=r(!0);function O(){u.value=u.value.replace(/\s+/g,"").replace(/[^0-9]/gi,"").replace(/(.{4})/g,"$1 ").trim()}function W(){i.value=i.value.replace(/\s+/g,"").replace(/[^0-9]/gi,"").replace(/(.{2})(?=.)/g,"$1/").trim()}function Z(){v.value=v.value.replace(/\D/g,"")}function J(t){const s=parseInt(t,10);return s>=1&&s<=12}const K=le(),L=he();async function Q(){N.value=!!u.value,b.value=!!i.value,w.value=!!v.value;const t=i.value.split("/");if(u.value.length===19?g.value=!0:g.value=!1,i.value.length===5&&J(t[0])?y.value=!0:y.value=!1,v.value.length===3?S.value=!0:S.value=!1,N.value&&b.value&&w.value&&g.value&&y.value&&S.value)try{const s=ve(A),l=k(A,"users",f.value.uid,"orders",L);s.set(l,{order:B,total:V.totalPrice,time:M(),state:"訂單處理中"});for(const a of B){const I=a.category==="man"?"manClothes":a.category==="woman"?"womanClothes":"accessory",C=k(A,I,a.id),D=await _e(C);if(D.exists()){const $=D.data();if($[z(a)]>=a.quantity){const X=$[z(a)]-a.quantity;s.update(C,{[z(a)]:X})}else throw new Error(`Insufficient stock for ${a.name} in size ${a.size}`)}}await s.commit(),V.cleanCartItems(),K.push({path:"/confirm/complete"})}catch(s){console.error("Error completing order: ",s),x({message:"訂單處理出錯，請重試",type:"error",plain:!0})}else x({message:"請輸入正確資訊",type:"error",plain:!0})}return(t,s)=>{const l=re("el-input");return ne(),ce("div",fe,[ge,e("div",ye,[Se,Ce,e("div",De,d(_(U)),1),Ve,e("div",ze,d(F.value),1),e("div",Ne,d(_(Y)),1),be,e("div",we,d(_(T))+d(_(j)),1),e("div",Ie,d(_(G)),1),qe,e("div",Ae,d(_(H)),1)]),Be,e("div",$e,[ke,e("div",xe,[Me,e("div",Pe,[e("div",Ue,[Ee,q(l,{placeholder:"0000 0000 0000 0000",modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=a=>u.value=a),maxlength:"19",onInput:O},null,8,["modelValue"]),p(e("div",Re,"此欄不得為空",512),[[m,!N.value]]),p(e("div",Fe,"請輸入正確格式",512),[[m,!g.value]])]),e("div",Ye,[e("div",Te,[je,q(l,{placeholder:"MM/YY",modelValue:i.value,"onUpdate:modelValue":s[1]||(s[1]=a=>i.value=a),maxlength:"5",onInput:W},null,8,["modelValue"]),p(e("div",Ge,"此欄不得為空",512),[[m,!b.value]]),p(e("div",He,"請輸入正確格式",512),[[m,!y.value]])]),e("div",Oe,[We,q(l,{placeholder:"000",modelValue:v.value,"onUpdate:modelValue":s[2]||(s[2]=a=>v.value=a),maxlength:"3",onInput:Z},null,8,["modelValue"]),p(e("div",Ze,"此欄不得為空",512),[[m,!w.value]]),p(e("div",Je,"請輸入正確格式",512),[[m,!S.value]])])])])])]),e("div",{class:"confirm",onClick:Q},"下一步 : 下訂單")])}}}),Qe=pe(Ke,[["__scopeId","data-v-837e01d7"]]);export{Qe as default};
