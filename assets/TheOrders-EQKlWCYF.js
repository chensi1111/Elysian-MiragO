import{X as M,b as h,d as W,V as b,W as F,G as L,f as R,g as U,r as k,o as i,j as l,B as T,F as z,p as S,ac as $,$ as m,ad as j,m as O,H as D,k as t,C as r,J as G,Z as x,S as H,a0 as J,Y as K,T as A,D as Q,E as X,_ as Y}from"./index-Cnln09QU.js";const Z=M("currentOrder",()=>({orderType:h("")})),ee=_=>(Q("data-v-2689e609"),_=_(),X(),_),te={key:0},se={key:1,class:"empty"},ae={class:"orderTitle"},oe={class:"orderID"},ne={class:"orderTime"},ce={class:"pic"},re=["src"],ie={class:"content"},le={class:"name"},de={class:"details"},ue={class:"detail"},_e={class:"detail"},he={class:"prices"},ve={class:"price"},fe={class:"quantity"},me={class:"total"},pe={class:"totalContainer"},ye={class:"states"},ge=["onClick"],Ce=ee(()=>t("i",{class:"fa-solid fa-trash-can"},null,-1)),Te={class:"state"},ze={key:1,class:"refund"},De={class:"totalPrice"},we=W({__name:"TheOrders",setup(_){const w=h(!0),P=b(),d=h();F(P,e=>{e&&(d.value=e,p(e))});const u=h(),p=async e=>{if(e){const c=$(m,"users",e.uid,"orders"),a=await j(c);u.value=a.docs.map(s=>({id:s.id,...s.data()}))}},v=Z(),q=L(()=>Array.isArray(u.value)?v.orderType=="處理中訂單"?u.value.filter(e=>e.state==="訂單處理中"):v.orderType=="已完成訂單"?u.value.filter(e=>e.state==="訂單已完成"):v.orderType=="已取消訂單"?u.value.filter(e=>e.state==="訂單已取消"):u.value:[]),y=h();function I(e){return[...e].sort((c,a)=>new Date(a.time).getTime()-new Date(c.time).getTime())}R(q,e=>{y.value=I(e)}),U(async()=>{d.value&&await p(d.value),v.orderType="處理中訂單",w.value=!1});function g(e){return e.toLocaleString()}function N(e){let c=0;const a=Math.floor(e.quantity/3),s=e.quantity%3;return c+=a*3*e.price*.8,c+=s*e.price,c}function C(e){switch(e.size){case"32A":return"size32A";case"32B":return"size32B";case"32C":return"size32C";case"32D":return"size32D";case"34A":return"size34A";case"34B":return"size34B";case"34C":return"size34C";case"34D":return"size34D";case"36A":return"size36A";case"36B":return"size36B";case"36C":return"size36C";case"36D":return"size36D";case"24":return"size24";case"25":return"size25";case"26":return"size26";default:return e.size}}function V(e){if(d.value){const c=x(m,"users",d.value.uid,"orders",e.id);H.confirm("確定要取消訂單嗎","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{const a=J(m);a.update(c,{state:"訂單已取消"});for(const s of e.order){const o=s.category==="man"?"manClothes":s.category==="woman"?"womanClothes":"accessory",n=x(m,o,s.id),f=await K(n);if(f.exists()){const B=f.data();if(B[C(s)]!==void 0){const E=B[C(s)]+s.quantity;a.update(n,{[C(s)]:E})}}}await a.commit(),p(d.value),A({type:"success",message:"訂單已取消"})}).catch(()=>{A({type:"warning",message:"訂單取消失敗"})})}}return(e,c)=>{const a=k("el-collapse-item"),s=k("el-collapse");return i(),l(z,null,[w.value?(i(),l("div",te,"加載中...")):y.value.length?T("",!0):(i(),l("div",se,"查無訂單記錄")),(i(!0),l(z,null,S(y.value,o=>(i(),l("div",{class:"order",key:o.id},[O(s,null,{default:D(()=>[O(a,null,{title:D(()=>[t("div",ae,[t("div",oe,r(o.id),1),t("div",ne,r(o.time),1)])]),default:D(()=>[(i(!0),l(z,null,S(o.order,(n,f)=>(i(),l("div",{class:"orderProduct",key:f},[t("div",ce,[t("img",{src:n.img},null,8,re)]),t("div",ie,[t("div",le,r(n.name),1),t("div",de,[t("div",ue,"顏色 : "+r(n.color),1),t("div",_e,"尺寸 : "+r(n.size),1)]),t("div",he,[t("div",ve,"TWD"+r(g(n.price)),1),t("div",fe,"x"+r(n.quantity),1),t("div",me," TWD"+r(g(N(n))),1)])])]))),128)),t("div",pe,[t("div",ye,[o.state!=="訂單已取消"?(i(),l("div",{key:0,class:"cancle",onClick:n=>V(o)},[Ce,G("取消訂單 ")],8,ge)):T("",!0),t("div",Te,r(o.state),1),o.state=="訂單已取消"?(i(),l("div",ze,"退款處理中")):T("",!0)]),t("div",De,"總價 : "+r(g(o.total)),1)])]),_:2},1024)]),_:2},1024)]))),128))],64)}}}),ke=Y(we,[["__scopeId","data-v-2689e609"]]);export{ke as T,Z as u};
